zUID
====
zUID is unique ID generator based on ZeroMQ.

Features
-----------------
  - multi node deployment for redundancy and scalability (shared nothing cluster of zUID instances)
  - dead simple protocol for communication(based on ZeroMQ)
  - built in timestamp. you don't need to add another field to your table for record tracking (ex. creation_date)
  - strong uniqueness guarantee

Usage
-----------------
  - If you have shard your database and need to have cross shard unique id
  - id generation must be done at client side for whatever reason

Number Format
--------------
Numbers generated by zUID is based on:
  - All numbers are represented as 64 bit long
  - only 63 bit can be used for generating positive numbers
  - 4 most significant bits are for mashine number. starting from 0 to 15
  - 3 bits after mashine number is thread number which is hardcoded starting from 0 to 7
  - 11 bit is used as rounding auto increment number
  - the least significant 45 bit is timestamp of system in millisecond

Uniqueness guarantee
--------------
In theory above algorithm generates duplicate number if a single thread in whole zUID cluster (16 mashines at maximum with 8 threads in each) generates 2048 numbers per millisecond.

Protocol
--------------
Communicating with zUID is dead simple: 
  - Create a `DEALER` socket in ZeroMQ 
  - Connect to random zUID instance. zUID cluster is shared nothing cluster. Typically each instance runs on different mashine
  - Create a single frame massage that contains number of ids you want in ASCII string
  - Response will be a multi frame message. Each frame will contain one number in ASCII string

Example:
--------------
Here is simple client example in C:
```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <czmq.h>

int main() {
	
	/* create ZeroMQ context */
	zctx_t *ctx = zctx_new();
	
	/* create DEALER socket */
	void *client = zsocket_new(ctx, ZMQ_DEALER);
	
	/* connect to server */
	zsocket_connect(client, "tcp://192.168.0.51:5656");
	
	/* create a message */
	zmsg_t *msg = zmsg_new();
	
	/* there is only one frame which contains number of ids client want */
	zmsg_pushstr(msg, "10");
	
	/* send to server */
	zmsg_send(&msg, client);
	
	/* receive response which is multi frame message. Each frame is a number */
	zmsg_t *response = zmsg_recv(client);
	
	/* dump message */
	zmsg_dump(response);
	
	zmsg_destroy(&response);
	
	zsocket_destroy(ctx, client);
	zctx_destroy(&ctx);
	
	return 0;
}
```
compile client using `gcc -o client client.c -lczmq -lzmq`. Output will be like:
```
--------------------------------------
[017] 72059030285626637
[017] 72094214657715469
[017] 72129399029804301
[017] 72164583401893133
[017] 72199767773981965
[017] 72234952146070797
[017] 72270136518159629
[017] 72305320890248461
[017] 72340505262337293
[017] 72375689634426125
```

Installation
--------------
```sh
git clone https://github.com/majidazimi/zUID.git zUID
cd zUID
./configure
make
make install
```

Dependencies
--------------
zUID has been written using `libzmq` and `CZMQ`. You will need those for installation.

Usage
--------------
to run zUID just specify mashine number for that zUID instance, bind address and port number to listern: `zuid -m [mashine number] -b [bind address] -p [port]`. For example `zuid -m 10`. bind address and port number are optional. Default bind address is `0.0.0.0` and default port number is `5656`.

Running as daemon
--------------
zUID itself does not run as daemon. So you need to run something like supervisord. zUID does not require any special permission(unless you run it on privileged port). A sample supervisor configuration is like:
```
[program:zUID]
command=zuid -m 2 -p 5656
user=nobody
```

Notes
--------------
  - zUID heavily depends on NTP. Least significant 45 bit of a number is timestamp in millisecond. Clock drift can cause duplicate numbers. Be sure to run reliable NTP service on your zUID cluster. on Linux you can run `ntpd` or `chronyd`.
  - There is no authentication/authorization feature in zUID. This will NOT be implemented in the future.
  - If client sends a malformed message(more than one frame, ...) it will be silently discarded. This may be improved in near future.
  
License
----
GPL version 3
